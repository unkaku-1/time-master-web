<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录调试页面</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin: 10px 0; }
        input { padding: 8px; margin: 5px; width: 200px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .result { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .error { background: #ffebee; border-color: #f44336; }
        .success { background: #e8f5e8; border-color: #4caf50; }
    </style>
</head>
<body>
    <h1>登录功能调试</h1>
    
    <div class="form-group">
        <label>用户名:</label>
        <input type="text" id="username" value="admin" placeholder="输入用户名">
    </div>
    
    <div class="form-group">
        <label>密码:</label>
        <input type="password" id="password" value="admin4fmm" placeholder="输入密码">
    </div>
    
    <button onclick="testLogin()">测试登录</button>
    <button onclick="clearLogs()">清除日志</button>
    
    <div id="result" class="result"></div>
    <div id="logs" class="result"></div>
    
    <script>
        // 重写 console.log 来显示在页面上
        const originalLog = console.log;
        const originalError = console.error;
        
        function addLog(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.style.margin = '2px 0';
            logEntry.style.padding = '2px 5px';
            logEntry.style.fontSize = '12px';
            
            if (type === 'error') {
                logEntry.style.color = 'red';
                logEntry.textContent = '[ERROR] ' + message;
            } else {
                logEntry.style.color = 'blue';
                logEntry.textContent = '[LOG] ' + message;
            }
            
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            document.getElementById('result').innerHTML = '';
        }
        
        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            
            console.log('开始测试登录功能');
            console.log('用户名:', username);
            console.log('密码:', password ? '***' : '(空)');
            
            // 检查环境变量
            console.log('检查环境变量:');
            console.log('VITE_DEV_MODE:', 'true');
            console.log('VITE_MOCK_LOGIN:', 'true');
            console.log('import.meta.env.DEV:', true);
            
            // 模拟开发模式检查
            const isDevelopmentMode = true; // 强制开发模式
            console.log('开发模式状态:', isDevelopmentMode);
            
            if (isDevelopmentMode) {
                console.log('开发模式已启用，使用模拟登录');
                
                if (username === 'admin' && password === 'admin4fmm') {
                    console.log('开发模式：管理员账号验证成功');
                    
                    const mockUser = {
                        id: 1,
                        username: 'admin',
                        email: 'admin@company.com',
                        name: '系统管理员',
                        is_admin: true,
                        department: 'IT部门',
                        created_at: new Date().toISOString()
                    };
                    
                    console.log('创建模拟用户:', mockUser);
                    console.log('开发模式登录成功');
                    
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = '<h3>登录成功!</h3><pre>' + JSON.stringify(mockUser, null, 2) + '</pre>';
                } else {
                    console.log('开发模式：用户名或密码错误');
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '<h3>登录失败!</h3><p>用户名或密码错误（开发模式：请使用 admin/admin4fmm）</p>';
                }
            } else {
                console.log('非开发模式，需要连接后端 API');
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>错误!</h3><p>开发模式未启用</p>';
            }
        }
        
        // 页面加载时显示环境信息
        window.onload = function() {
            console.log('页面加载完成');
            console.log('当前 URL:', window.location.href);
            console.log('准备测试登录功能');
        };
    </script>
</body>
</html>